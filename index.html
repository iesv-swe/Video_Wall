<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Video Wall</title>
    <style>
        /* --- RESET & HIDE SCROLLBARS --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden; /* CRITICAL: Prevents white scrollbars */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* --- THE STAGE --- */
        #stage {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden; 
        }

        /* --- THE IMAGE DISPLAY --- */
        #wall-display {
            position: absolute;
            display: block;
            transition: opacity 0.5s ease;
        }

        /* --- THE CLOCK OVERLAY --- */
        #clock-overlay {
            position: absolute;
            bottom: 30px;
            right: 30px;
            font-size: 4rem; /* Big, visible text */
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 2px 2px 8px #000000; /* Drop shadow for readability */
            z-index: 9999; /* Always on top */
            pointer-events: none; /* Let clicks pass through */
        }
    </style>
</head>
<body>

    <div id="stage">
        <!-- Main Image Element with Error Hiding -->
        <img id="wall-display" src="" alt="" onerror="this.style.display='none'">
        
        <!-- The Digital Clock -->
        <div id="clock-overlay">--:--</div>
    </div>

    <!-- PRELOADER (Hidden) -->
    <div style="display:none;">
        <img id="preload-individual" src="">
        <img id="preload-stretch" src=""> 
    </div>

    <script>
        // --- CONFIGURATION ---
        const STRETCH_START_TIME = 30; // Seconds into the minute to switch
        
        // VERSION CONTROL: Change this to '2', '3', etc. to force devices to re-download images
        const VERSION = '1'; 

        // BEZEL COMPENSATION (In Pixels)
        // Adjust this if the image looks "cut" by the plastic frames. 
        // Try 20, 40, or 60 if needed.
        const BEZEL_OFFSET = 0; 

        // --- SETUP ---
        const urlParams = new URLSearchParams(window.location.search);
        // Default to '1' if no ID provided
        const screenId = urlParams.get('device') || urlParams.get('id') || '1';
        
        const imgElement = document.getElementById('wall-display');
        const clockElement = document.getElementById('clock-overlay');

        // CLOCK VISIBILITY: Only show on Screen 4
        if (screenId !== '4') {
            clockElement.style.display = 'none';
        }
        
        // Construct URLs with Versioning
        const individualImage = 'screen' + screenId + '.jpg?v=' + VERSION;
        const stretchImage = 'stretched.jpg?v=' + VERSION; // Note: 'stretched.jpg' per your file
        
        // Preload Images immediately
        document.getElementById('preload-individual').src = individualImage;
        document.getElementById('preload-stretch').src = stretchImage;


        // --- MAIN LOOP ---
        function updateDisplay() {
            const now = new Date();
            const currentSecond = now.getSeconds();

            // 1. UPDATE CLOCK (Only if visible)
            if (screenId === '4') {
                // Formats time as 12:34 (HH:MM)
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                clockElement.innerText = timeString;
            }

            // 2. UPDATE IMAGES
            // --- PHASE 1: INDIVIDUAL MODE (0-29s) ---
            if (currentSecond < STRETCH_START_TIME) {
                // Only update if source is different (prevents flickering)
                if (!imgElement.src.includes(individualImage)) {
                    imgElement.style.display = 'block';
                    imgElement.src = individualImage;
                    
                    // Reset CSS for Single Screen
                    imgElement.style.width = "100%";
                    imgElement.style.height = "100%";
                    imgElement.style.top = "0";
                    imgElement.style.left = "0";
                    imgElement.style.objectFit = "contain";
                }
            } 
            
            // --- PHASE 2: STRETCH MODE (30-59s) ---
            else {
                if (!imgElement.src.includes(stretchImage)) {
                    imgElement.style.display = 'block';
                    imgElement.src = stretchImage;
                    
                    // FORCE 200% SIZE (Plus Bezel Compensation)
                    imgElement.style.width = "calc(200vw + " + (BEZEL_OFFSET * 2) + "px)";
                    imgElement.style.height = "200vh"; 
                    imgElement.style.objectFit = "fill"; 
                    
                    // COORDINATES (Moving the giant image)
                    switch (screenId) {
                        case '1': // Top Left
                            imgElement.style.top = "0";
                            imgElement.style.left = "0"; 
                            break;
                        case '2': // Top Right
                            imgElement.style.top = "0";
                            // Pull image left by 1 screen width + bezel
                            imgElement.style.left = "calc(-100vw - " + BEZEL_OFFSET + "px)";
                            break;
                        case '3': // Bottom Left
                            imgElement.style.top = "-100vh"; 
                            imgElement.style.left = "0";
                            break;
                        case '4': // Bottom Right
                            imgElement.style.top = "-100vh";
                            imgElement.style.left = "calc(-100vw - " + BEZEL_OFFSET + "px)";
                            break;
                    }
                }
            }
        }

        // --- WAKE LOCK API (Prevents Screen Sleep) ---
        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock is active!');
                    
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake Lock was released');
                    });
                }
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        // Request lock on load
        requestWakeLock();

        // Re-request if window regains focus (failsafe)
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                requestWakeLock();
            }
        });

        // Run loop every 200ms
        setInterval(updateDisplay, 200);
        updateDisplay();
    </script>
</body>
</html>
